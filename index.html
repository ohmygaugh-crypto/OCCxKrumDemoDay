<!DOCTYPE html> <html><head>
		<title>OCC Gen3 x Krumware</title>
		<base href="./">
		<meta id="root-path" root-path="./">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="PublicDigitalGarden - OCC Gen3 x Krumware">
		<meta property="og:title" content="OCC Gen3 x Krumware">
		<meta property="og:description" content="PublicDigitalGarden - OCC Gen3 x Krumware">
		<meta property="og:type" content="website">
		<meta property="og:url" content="occ-gen3-x-krumware.html">
		<meta property="og:image" content="https://lh7-us.googleusercontent.com/VOyBnXdrI-xH031yJiM84XYv7cyz6vUOfQFGP4lyA8pesorP468Bfsz8HytcXLchIldPHTnjpH6zq1sjvyE1U7SFCupUxmUPfwArXBPVH6yCHkCShp3gYuaoY_Z19YMBWbobtPCNZUpCgYk-">
		<meta property="og:site_name" content="PublicDigitalGarden">
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/cursor-chat/dist/style.css"/>
    <script type="module">
      import { initCursorChat } from 'https://esm.sh/cursor-chat'
      initCursorChat("your-room-name-here")
    </script>
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.png"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark native-scrollbars show-inline-title"><div id="cursor-chat-layer"><input type="text" id="cursor-chat-box"></div></div><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="view-content"><style id="MJX-CHTML-styles"></style><div class="canvas-wrapper node-insert-event" tabindex="-1" data-ignore-swipe="true" style="--zoom-multiplier: 1;"><svg class="canvas-background"><pattern id="a60714d21eacc797" patternUnits="userSpaceOnUse" x="1136" y="0" width="20" height="20"><circle cx="0.7" cy="0.7" r="0.7"></circle></pattern><rect x="0" y="0" width="100%" height="100%" fill="url(#a60714d21eacc797)"></rect></svg><div class="canvas-card-menu" style="z-index: 18;"><div class="canvas-card-menu-button mod-draggable" aria-label="Drag to add card" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-sticky-note"><path d="M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z"></path><path d="M15 3v6h6"></path></svg></div><div class="canvas-card-menu-button mod-draggable" aria-label="Drag to add note from vault" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-file-text"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg></div><div class="canvas-card-menu-button mod-draggable" aria-label="Drag to add media from vault" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-file-image"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><circle cx="10" cy="13" r="2"></circle><path d="m20 17-1.09-1.09a2 2 0 0 0-2.82 0L10 22"></path></svg></div></div><div class="canvas-controls" style="z-index: 18;"><div class="canvas-control-group"><div class="canvas-control-item" aria-label="Canvas settings" data-tooltip-position="left"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg></div></div><div class="canvas-control-group"><div class="canvas-control-item" aria-label="Zoom in" data-tooltip-position="left"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-plus"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg></div><div class="canvas-control-item" aria-label="Reset zoom" data-tooltip-position="left"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-rotate-cw"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path></svg></div><div class="canvas-control-item" aria-label="Zoom to fit
(⇧ 1)" data-tooltip-position="left"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-maximize"><path d="M8 3H5a2 2 0 0 0-2 2v3"></path><path d="M21 8V5a2 2 0 0 0-2-2h-3"></path><path d="M3 16v3a2 2 0 0 0 2 2h3"></path><path d="M16 21h3a2 2 0 0 0 2-2v-3"></path></svg></div><div class="canvas-control-item" aria-label="Zoom out" data-tooltip-position="left"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-minus"><path d="M5 12h14"></path></svg></div></div><div class="canvas-control-group"><div class="canvas-control-item is-disabled" aria-label="Undo" data-tooltip-position="left"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-undo-2"><path d="M9 14 4 9l5-5"></path><path d="M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11"></path></svg></div><div class="canvas-control-item is-disabled" aria-label="Redo" data-tooltip-position="left"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-redo-2"><path d="m15 14 5-5-5-5"></path><path d="M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13"></path></svg></div></div><div class="canvas-control-group"><div class="canvas-control-item" aria-label="Canvas help" data-tooltip-position="left"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-help-circle"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><path d="M12 17h.01"></path></svg></div></div></div><div class="canvas" style="transform: translate(1136px, 0px) scale(1) translate(0px, 0px);"><svg class="canvas-edges"><g><path class="canvas-interaction-path" d="M4904 -6260 L4911 -6260 M4911,-6260 C5061,-6260 5207,-6888 5357,-6888"></path><path class="canvas-display-path" d="M4904 -6260 L4911 -6260 M4911,-6260 C5061,-6260 5207,-6888 5357,-6888"></path></g><g class="is-themed mod-canvas-color-4"><path class="canvas-interaction-path" d="M6400 -5316 L6407 -5316 M6407,-5316 C6557,-5316 3950,-4868 4100,-4868"></path><path class="canvas-display-path" d="M6400 -5316 L6407 -5316 M6407,-5316 C6557,-5316 3950,-4868 4100,-4868"></path></g><g class="is-themed mod-canvas-color-3"><path class="canvas-interaction-path" d="M6400 -5316 L6407 -5316 M6407,-5316 C6557,-5316 4963,-4867.5 5113,-4867.5"></path><path class="canvas-display-path" d="M6400 -5316 L6407 -5316 M6407,-5316 C6557,-5316 4963,-4867.5 5113,-4867.5"></path></g><g class="is-themed mod-canvas-color-2"><path class="canvas-interaction-path" d="M6400 -5316 L6407 -5316 M6407,-5316 C6557,-5316 5883,-4867 6033,-4867"></path><path class="canvas-display-path" d="M6400 -5316 L6407 -5316 M6407,-5316 C6557,-5316 5883,-4867 6033,-4867"></path></g><g class="is-themed mod-canvas-color-1"><path class="canvas-interaction-path" d="M6400 -5316 L6407 -5316 M6407,-5316 C6557,-5316 6843,-4839 6993,-4839"></path><path class="canvas-display-path" d="M6400 -5316 L6407 -5316 M6407,-5316 C6557,-5316 6843,-4839 6993,-4839"></path></g><g class="is-themed mod-canvas-color-3"><path class="canvas-interaction-path" d="M5526.5 -4776 L5526.5 -4769 M5526.5,-4769 C5526.5,-4619 4993,-4171 4993,-4021"></path><path class="canvas-display-path" d="M5526.5 -4776 L5526.5 -4769 M5526.5,-4769 C5526.5,-4619 4993,-4171 4993,-4021"></path></g><g><path class="canvas-interaction-path" d="M4000 -6260 L3993 -6260 M3993,-6260 C3843,-6260 5123,-5316 5273,-5316"></path><path class="canvas-display-path" d="M4000 -6260 L3993 -6260 M3993,-6260 C3843,-6260 5123,-5316 5273,-5316"></path></g><g><path class="canvas-interaction-path" d="M5280 -5316 L5273 -5316 M5273,-5316 C5123,-5316 3843,-6260 3993,-6260"></path><path class="canvas-display-path" d="M5280 -5316 L5273 -5316 M5273,-5316 C5123,-5316 3843,-6260 3993,-6260"></path></g><g class="is-themed mod-canvas-color-4"><path class="canvas-interaction-path" d="M4567 -4776 L4567 -4769 M4567,-4769 C4567,-4619 3490,-4171 3490,-4021"></path><path class="canvas-display-path" d="M4567 -4776 L4567 -4769 M4567,-4769 C4567,-4619 3490,-4171 3490,-4021"></path></g><g class="is-themed mod-canvas-color-2"><path class="canvas-interaction-path" d="M6400 -4753 L6400 -4746 M6400,-4746 C6400,-4596 6602,-4188 6602,-4038"></path><path class="canvas-display-path" d="M6400 -4753 L6400 -4746 M6400,-4746 C6400,-4596 6602,-4188 6602,-4038"></path></g><g class="is-themed mod-canvas-color-1"><path class="canvas-interaction-path" d="M7361.5 -4697 L7361.5 -4690 M7361.5,-4690 C7361.5,-4540 8208.5,-4188 8208.5,-4038"></path><path class="canvas-display-path" d="M7361.5 -4697 L7361.5 -4690 M7361.5,-4690 C7361.5,-4540 8208.5,-4188 8208.5,-4038"></path></g></svg><svg class="canvas-edges"><g><g style="transform: translate(5364px, -6888px) rotate(90deg);"><polygon class="canvas-path-end" points="0,0 6.5,10.4 -6.5,10.4"></polygon></g></g><g class="is-themed mod-canvas-color-4"><g style="transform: translate(4107px, -4868px) rotate(90deg);"><polygon class="canvas-path-end" points="0,0 6.5,10.4 -6.5,10.4"></polygon></g></g><g class="is-themed mod-canvas-color-3"><g style="transform: translate(5120px, -4867.5px) rotate(90deg);"><polygon class="canvas-path-end" points="0,0 6.5,10.4 -6.5,10.4"></polygon></g></g><g class="is-themed mod-canvas-color-2"><g style="transform: translate(6040px, -4867px) rotate(90deg);"><polygon class="canvas-path-end" points="0,0 6.5,10.4 -6.5,10.4"></polygon></g></g><g class="is-themed mod-canvas-color-1"><g style="transform: translate(7000px, -4839px) rotate(90deg);"><polygon class="canvas-path-end" points="0,0 6.5,10.4 -6.5,10.4"></polygon></g></g><g class="is-themed mod-canvas-color-3"><g style="transform: translate(4993px, -4014px) rotate(180deg);"><polygon class="canvas-path-end" points="0,0 6.5,10.4 -6.5,10.4"></polygon></g></g><g><g style="transform: translate(5280px, -5316px) rotate(90deg);"><polygon class="canvas-path-end" points="0,0 6.5,10.4 -6.5,10.4"></polygon></g></g><g><g style="transform: translate(4000px, -6260px) rotate(90deg);"><polygon class="canvas-path-end" points="0,0 6.5,10.4 -6.5,10.4"></polygon></g></g><g class="is-themed mod-canvas-color-4"><g style="transform: translate(3490px, -4014px) rotate(180deg);"><polygon class="canvas-path-end" points="0,0 6.5,10.4 -6.5,10.4"></polygon></g></g><g class="is-themed mod-canvas-color-2"><g style="transform: translate(6602px, -4031px) rotate(180deg);"><polygon class="canvas-path-end" points="0,0 6.5,10.4 -6.5,10.4"></polygon></g></g><g class="is-themed mod-canvas-color-1"><g style="transform: translate(8208.5px, -4031px) rotate(180deg);"><polygon class="canvas-path-end" points="0,0 6.5,10.4 -6.5,10.4"></polygon></g></g></svg><div class="canvas-node" style="z-index: 2; transform: translate(6673px, -7080px); width: 916px; height: 1564px; --canvas-node-width: 916px; --canvas-node-height: 1564px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>**</p></div><div class="heading-wrapper"><h2 data-heading="Solutions" class="heading" id="Solutions"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Solutions</h2><div class="heading-children"><div class="heading-wrapper"><h3 data-heading="Possible Issues for spinning up VPC" class="heading" id="Possible_Issues_for_spinning_up_VPC"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Possible Issues for spinning up VPC</h3><div class="heading-children"><div><ul>
<li data-line="0">
<p>If you get an error about&nbsp; --create-bucket-configuration&nbsp;</p>
</li>
<li data-line="3">
<p>please change line 116 in file cloud-automation/gen3/bin/workon.sh&nbsp; and replace <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/cloud-automation/blob/997c596d86d22b4e085bc6da4e714050f06c7d16/gen3/bin/workon.sh#L116C83-L116C113" rel="noopener" class="external-link" href="https://github.com/uc-cdis/cloud-automation/blob/997c596d86d22b4e085bc6da4e714050f06c7d16/gen3/bin/workon.sh#L116C83-L116C113" target="_blank">this line</a> with the following<br>
gen3_aws_run aws s3api create-bucket --acl private --bucket "$GEN3_S3_BUCKET" --region $(aws configure get $GEN3_PROFILE.region)</p>
</li>
<li data-line="7">
<p>If the error says there is an issue with the backend for S3, please do the following</p>
</li>
<li data-line="10">
<p>After the gen3 workon command, do gen3 cd and ls. You should be able to see a file named backend.tfvars<br>
</p>
</li>
<li data-line="12">
<p>Open that file and add the following line in the file<br>
profile = &lt;&gt;<br>
</p>
</li>
<li data-line="15">
<p>Once done, re-run the gen3 workon command</p>
</li>
</ul></div></div></div><div class="heading-wrapper"><h3 data-heading="How to Update AWS and Kubectl" class="heading" id="How_to_Update_AWS_and_Kubectl"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>How to Update AWS and Kubectl&nbsp;</h3><div class="heading-children"><div><ul>
<li data-line="0">
<p>Windows:</p>
</li>
<li data-line="3">
<p>Open Command Prompt or PowerShell:</p>
</li>
<li data-line="6">
<p>Press Win + R, type cmd or powershell, and hit Enter.</p>
</li>
<li data-line="9">
<p>Update kubectl:</p>
</li>
<li data-line="12">
<p>Run kubectl version --client to check the current version.<br>
</p>
</li>
<li data-line="14">
<p>If outdated, download the latest version from the Kubernetes website.<br>
</p>
</li>
<li data-line="16">
<p>Replace the old kubectl.exe with the new one in your PATH environment variable.</p>
</li>
<li data-line="19">
<p>Update AWS CLI:</p>
</li>
<li data-line="22">
<p>Run aws --version to check the current version.<br>
</p>
</li>
<li data-line="24">
<p>If outdated, download the latest version from the AWS website.<br>
</p>
</li>
<li data-line="26">
<p>Install it and update your PATH if necessary.</p>
</li>
<li data-line="29">
<p>macOS:</p>
</li>
<li data-line="32">
<p>Open Terminal:</p>
</li>
<li data-line="35">
<p>Use Spotlight (Cmd + Space) and search for "Terminal" to open it.</p>
</li>
<li data-line="38">
<p>Update kubectl:</p>
</li>
<li data-line="41">
<p>Run kubectl version --client to check the current version.<br>
</p>
</li>
<li data-line="43">
<p>Use Homebrew to update: brew upgrade kubectl or specify a version like brew install kubectl@.</p>
</li>
<li data-line="46">
<p>Update AWS CLI:</p>
</li>
<li data-line="49">
<p>Run aws --version to check the current version.<br>
</p>
</li>
<li data-line="51">
<p>Use Homebrew to update: brew upgrade awscli.</p>
</li>
<li data-line="54">
<p>Ubuntu (Linux):</p>
</li>
<li data-line="57">
<p>Open Terminal:</p>
</li>
<li data-line="60">
<p>Use Ctrl + Alt + T or search for "Terminal" in your applications.</p>
</li>
<li data-line="63">
<p>Update kubectl:</p>
</li>
<li data-line="66">
<p>Run kubectl version --client to check the current version.<br>
</p>
</li>
<li data-line="68">
<p>Use curl or wget to download the latest version from the Kubernetes GitHub releases.<br>
</p>
</li>
<li data-line="70">
<p>Install the downloaded binary and update your PATH if necessary.</p>
</li>
<li data-line="73">
<p>Update AWS CLI:</p>
</li>
<li data-line="76">
<p>Run aws --version to check the current version.<br>
</p>
</li>
<li data-line="78">
<p>Use pip to update AWS CLI: sudo pip install --upgrade awscli.</p>
</li>
</ul></div><div><p>**</p></div></div></div></div></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 3; transform: translate(5364px, -7200px); width: 974px; height: 624px; --canvas-node-width: 974px; --canvas-node-height: 624px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>**## Variables/Setup needed before starting the process</p></div><div><ol>
<li data-line="0">An AWS account number</li>
<li data-line="2">AWS IAM User named helm_gen3_user with administrator privileges. Please create AWS Secrets (AWS Secert key and ID) for this user.</li>
<li data-line="4">A common one-word name for the VM, VPC, and EKS that can be used to name these AWS resources</li>
<li data-line="6">Think of an AWS profile name that you want to use on your local machine to identify the AWS Account profile (Numbers 4 and 5 can be the same)</li>
<li data-line="8">Name for your Gen3 Data commons including any subdomain (i.e. abc.com, def.org)</li>
<li data-line="10">DNS setup is used to assign your website name (i.e. abc.com, def.org) which can be used to route to your Gen3 Data Commons</li>
<li data-line="12">ACM Certificate for your main domain which is decided in step 5</li>
<li data-line="14">Google OAuth Client ID and Client secret for Gen3 Login</li>
<li data-line="16">Indexd prefix for Gen3 data commons (You can get more information <a data-tooltip-position="top" aria-label="https://www.youtube.com/watch?v=t9uywGJAW7M" rel="noopener" class="external-link" href="https://www.youtube.com/watch?v=t9uywGJAW7M" target="_blank">here</a>)</li>
<li data-line="18">VPC CIDR ID, CIDR for your commons to live on.&nbsp;</li>
<li data-line="20">Make sure your terraform is on version 0.11.15 (You can use tfenv to deploy this version of terraform <a rel="noopener" class="external-link" href="https://github.com/tfutils/tfenv" target="_blank">https://github.com/tfutils/tfenv</a> )</li>
<li data-line="22">VPC ID and VPC CIDR for a new VPC or use any existing VPC from your AWS account that can be used to access Kubernetes&nbsp;</li>
<li data-line="24">IP addresses that can control the VM**</li>
</ol></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 4; transform: translate(5364px, -6520px); width: 974px; height: 628px; --canvas-node-width: 974px; --canvas-node-height: 628px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>**</p></div><div><p>Note:&nbsp;</p></div><div><ul>
<li data-line="0">For ask number 2, Create a new user in AWS with administrator privileges. Create a new user named helm_gen3_user with admin privileges in the new AWS Account. Make sure that the user can execute CLI commands. Once the user is created, please create the Access key from the security credentials tab.&nbsp;<br>
</li>
<li data-line="2">For 3 and 4 here I would be using demo-gen3-aws as a name for the AWS profile, gen3-admin as the VM name, VPC demo-gen3, and EKS: demo-gen3_eks.&nbsp;<br>
</li>
<li data-line="4">For 5 and 6, I would use demo-gen3.occ-pla.net as the domain for this demonstration<br>
</li>
<li data-line="6">For point 7, I would get the *.occ-pla.net certificate in AWS Certificate Manager by requesting a public certificate in the new AWS account. Example value is arn:aws:acm:us-east-1:XXXXXXXXX:certificate/asdaf-asfafa-asfca-af-asfada-da-v<br>
</li>
<li data-line="8">For 8, Gen3 uses any public or private OAuth client to authenticate the user. Generally, we use Google. We need the Client ID and Client secret for OAuth login. Information can be found <a data-tooltip-position="top" aria-label="https://developers.google.com/identity/gsi/web/guides/get-google-api-clientid#get_your_google_api_client_id" rel="noopener" class="external-link" href="https://developers.google.com/identity/gsi/web/guides/get-google-api-clientid#get_your_google_api_client_id" target="_blank">here</a> on how to set it up.&nbsp;<br>
</li>
<li data-line="10">I would be using dg.D3M0 for the data guid for this example for point 9.<br>
</li>
</ul></div><div><p>**</p></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 5; transform: translate(5280px, -5516px); width: 1120px; height: 400px; --canvas-node-width: 1120px; --canvas-node-height: 400px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>**</p></div><div class="heading-wrapper"><h2 data-heading="Objective" class="heading" id="Objective"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Objective</h2><div class="heading-children"><div><p>Embarking on the implementation of Gen3 in AWS using Gen3 Helm, this document is collaboratively shared with the krum.io team. The goal is to facilitate joint efforts between OCC and the Krum team. The process of spinning up Gen3 is structured into four distinct steps for clarity and effective collaboration.</p></div><div><p>The product team of Gen3 has written the steps in the documentation here, <a rel="noopener" class="external-link" href="https://github.com/uc-cdis/cloud-automation/blob/master/doc/csoc-free-commons-steps.md" target="_blank">https://github.com/uc-cdis/cloud-automation/blob/master/doc/csoc-free-commons-steps.md</a>, we will be using this as a base for this process</p></div><div><p>**</p></div></div></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 6; transform: translate(4107px, -4960px); width: 920px; height: 184px; --canvas-node-width: 920px; --canvas-node-height: 184px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>Step 1: Set up VM allowing access to AWS Account and Gen3 cloud-automation (Presented by Krum.io)</p></div><div><p>This is a preliminary step, we can also rename this as a setup stage. This step provides essential configuration details for initializing Gen3.</p></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 7; transform: translate(5120px, -4959px); width: 813px; height: 183px; --canvas-node-width: 813px; --canvas-node-height: 183px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>Step 2: Spin up VPC (Presented by Krum.io)</p></div><div><p>Step 2 involves utilizing Terraform and Gen3 scripts to spin up a virtual private cloud and databases. This process enables the establishment of the necessary infrastructure for your Gen3 environment.</p></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 8; transform: translate(6040px, -4981px); width: 720px; height: 228px; --canvas-node-width: 720px; --canvas-node-height: 228px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>Step 3: Spin up EKS (Presented by Krum.io)</p></div><div><p>In this step, EKS and additional configurations are initiated, paving the way for the subsequent deployment of Gen3 microservices. This sets the foundation for effectively establishing and utilizing Gen3 microservices within the system.</p></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 9; transform: translate(7000px, -4981px); width: 723px; height: 284px; --canvas-node-width: 723px; --canvas-node-height: 284px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>Step 4: Helm charts to implement Gen3 (Presented by Open Commons Consortium)</p></div><div><p>The final step in the Gen3 setup involves deploying a set of fundamental Gen3 microservices using Helm charts. This step specifically addresses the configuration of Helm values and guides initiating a basic data commons, completing the overall Gen3 implementation process.</p></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 10; transform: translate(5933px, -4031px); width: 1338px; height: 3514px; --canvas-node-width: 1338px; --canvas-node-height: 3514px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>**</p></div><div class="heading-wrapper"><h2 data-heading="Step 3: Spin up EKS" class="heading" id="Step_3:_Spin_up_EKS"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Step 3: Spin up EKS</h2><div class="heading-children"><div><p>In this step, we would execute the commands to set up EKS for our Gen3 with EC2 and other components using cloud automation scripts and Gen3 commands. This step would require the following variables out of the variable/setup information mentioned above</p></div><div><ol>
<li data-line="0">Name of AWS profile (defined in step 1 above)</li>
<li data-line="2">Name of VPC (Point 3 in Variables asked)</li>
<li data-line="4">VPC CIDR (Point 10 in Variables asked)</li>
<li data-line="6">VPC ID got in the output of <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.tmca1vv15vzc" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.tmca1vv15vzc" target="_blank">Step 2</a></li>
</ol></div><div><p><strong>Note</strong>: Make sure your terraform is on version 0.11.5 to use this script. To create EKS and resources, I’d be performing the following steps with demo-gen3_eks for EKS name and demo-gen3-aws AWS profile</p></div><div><ul>
<li data-line="0">Initialize the base module to run terraform to spin up EKS using the gen3 workon command. Gen3’s workon command sets up a terraform workspace folder for a given AWS profile and infrastructure type (for example, commons EKS, VPN server, data bucket).&nbsp; You can use this command anytime to access the Terraform backend. Ensure your ~/.bashrc changes made in step 1 are present and that ~/.bashrc is sourced. Generally, the command follows the syntax of gen3 workon &lt;&gt; &lt;&gt;_eks but for this instance, I would be executing the following command,</li>
</ul></div><div><pre><code>gen3 workon demo-gen3-aws demo-gen3_eks
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Note: make sure that the name of Kubernetes cluster ends with <code>_eks</code> while executing workon command  </p></div><div><ul>
<li data-line="0">Once terraform is successfully initialized, Give the following command to access the terraform files of the EKS by following command </li>
</ul></div><div><pre><code>gen3 cd
</code><button class="copy-code-button">Copy</button></pre></div><div><p>The ls command will show the list of EKS config files with an extension of <code>tfvars</code> and many more  </p></div><div><ul>
<li data-line="0">Open <code>config.tfvars</code> file, and the variables <code>vpc_name</code> and some others would be populated automatically to the values that we need. There are some other variables whose value should be changed like below,  </li>
</ul></div><div style="overflow-x: auto;"><table>
<thead>
<tr>
<th>Variable name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>ec2_keyname</td>
<td>demo-gen3</td>
</tr>
<tr>
<td>peering_cidr  <br>(point 12 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</td>
<td>172.X.X.0/16</td>
</tr>
<tr>
<td>peering_vpc_id  <br>(point 12 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</td>
<td>vpc-XXXXXXXXXX</td>
</tr>
<tr>
<td>sns_topic_arn</td>
<td>Remove lines with these variables</td>
</tr>
<tr>
<td>cidrs_to_route_to_gw</td>
<td>[“”]</td>
</tr>
<tr>
<td>eks_version</td>
<td>1.29</td>
</tr>
<tr>
<td>jupyter_asg_desired_capacity</td>
<td>1</td>
</tr>
<tr>
<td>jupyter_asg_max_size</td>
<td>10</td>
</tr>
<tr>
<td>jupyter_asg_min_size</td>
<td>1</td>
</tr>
<tr>
<td>workflow_asg_desired_capacity</td>
<td>3</td>
</tr>
<tr>
<td>workflow_asg_max_size</td>
<td>50</td>
</tr>
<tr>
<td>workflow_asg_min_size</td>
<td>3</td>
</tr>
<tr>
<td>deploy_workflow</td>
<td>true</td>
</tr>
</tbody>
</table></div><div><ul>
<li data-line="0">Once the variables are set up, you use the following commands to terraform plan and apply them to compile and run terraform<br>
</li>
</ul></div><div><pre><code>gen3 tfplan&nbsp;
</code><button class="copy-code-button">Copy</button></pre></div><div><p>This command is equivalent to the <code>terraform plan</code> which validates the configuration and creates an execution plan, which lets you preview the changes that Terraform plans to make to your infrastructure  </p></div><div><pre><code>gen3 tfapply  
</code><button class="copy-code-button">Copy</button></pre></div><div><p>This command is equivalent to <code>terraform apply</code> which command executes the actions proposed in a Terraform plan to create gen3 infrastructure.</p></div><div><ul>
<li data-line="0">If you run into any errors, please fine-tune the values in the <code>config.tfvars</code> file and re-run the </li>
</ul></div><div><pre><code>gen3 tfplan
</code><button class="copy-code-button">Copy</button></pre></div><div><p>and </p></div><div><pre><code>gen3 tfapply
</code><button class="copy-code-button">Copy</button></pre></div><div><p>command  </p></div><div><ul>
<li data-line="0">
<p>This terraform script can take about 20-40 min to execute depending on the network and system, once the terraform runs successfully, you will see the following output. Please note down all the values under Outputs with you for future reference.</p>
</li>
<li data-line="3">
<p>Once your EKS is deployed successfully, give the following command to update the kubeconfig file for your cluster. This will help you to manage the EKS cluster from your system. The command is aws eks --region &lt;&gt; update-kubeconfig --name &lt;&gt;_eks --profile &lt;&gt;. For the EKS spun up in this step, the command would be<br>
</p>
</li>
</ul></div><div><pre><code>aws eks --region us-east-1 update-kubeconfig --name demo-gen3_eks --profile demo-gen3-aws
</code><button class="copy-code-button">Copy</button></pre></div><div><ul>
<li data-line="0">If the following error is observed, follow steps A - D below</li>
</ul></div><div><pre><code>Error: Error applying plan:

  

1 error occurred:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* module.eks.null_resource.config_setup: Error running command 'bash test-validate_output_EKS/init_cluster.sh': exit status 1. Output: error: flag needs an argument: 'f' in -f

See 'kubectl apply --help' for usage.

error: error validating "test-validate_output_EKS/aws-auth-cm.yaml": error validating data: failed to download openapi: Get "[https://CD857734E2F2BC3EB155D0F2C0F34E45.yl4.us-east-1.eks.amazonaws.com/openapi/v2?timeout=32s](https://cd857734e2f2bc3eb155d0f2c0f34e45.yl4.us-east-1.eks.amazonaws.com/openapi/v2?timeout=32s)": getting credentials: decoding stdout: no kind "ExecCredential" is registered for version "client.authentication.k8s.io/v1alpha1" in scheme "pkg/client/auth/exec/exec.go:62"; if you choose to ignore these errors, turn validation off with --validate=false
</code><button class="copy-code-button">Copy</button></pre></div><div><p>a.) Update your kubeconfig as shown in the previous step:</p></div><div><pre><code>aws eks update-kubeconfig --region &lt;cluster-region&gt; --name &lt;cluster-name&gt;
</code><button class="copy-code-button">Copy</button></pre></div><div><p>b.) Take the cluster ARN and use it as your context in the following command:</p></div><div><p><code>kubectl config set-context &lt;cluster-arn&gt;</code></p></div><div><p>c.) From your EKS Terraform config directory, run the following command:</p></div><div><pre><code>kubectl apply -f &lt;outputs-directory&gt;/aws-auth-cm.yaml
</code><button class="copy-code-button">Copy</button></pre></div><div><p>d.) Validate that the nodes have joined the cluster:</p></div><div><pre><code>kubectl get nodes
</code><button class="copy-code-button">Copy</button></pre></div><div><p>The output should look like this:</p></div><div><pre><code>❯ kubectl get nodes

NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; STATUS &nbsp; ROLES&nbsp; &nbsp; AGE &nbsp; VERSION

ip-10-12-114-33.ec2.internal &nbsp; Ready&nbsp; &nbsp; &lt;none&gt; &nbsp; 27m &nbsp; v1.29.0-eks-5e0fdde

ip-10-12-148-93.ec2.internal &nbsp; Ready&nbsp; &nbsp; &lt;none&gt; &nbsp; 27m &nbsp; v1.29.0-eks-5e0fdde

gen3/test-validate_es:
</code><button class="copy-code-button">Copy</button></pre></div><div><p>**</p></div></div></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 11; transform: translate(7413px, -4031px); width: 1591px; height: 14267px; --canvas-node-width: 1591px; --canvas-node-height: 14267px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>**</p></div><div class="heading-wrapper"><h2 data-heading="Step 4: Helm charts to implement Gen3" class="heading" id="Step_4:_Helm_charts_to_implement_Gen3"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Step 4: Helm charts to implement Gen3</h2><div class="heading-children"><div><p>This step would determine the steps to implement Gen3 microservices to run Gen3 services on the EKS we created. This document would be using scripts and steps from the <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm" target="_blank">gen3-helm</a> git repository. This step would require the following variables out of the variable/setup information mentioned below</p></div><div><ol>
<li data-line="0">Name of EKS form Outputs of <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.ifttlwa4003s" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.ifttlwa4003s" target="_blank">Step 3</a></li>
</ol></div><div><p>Each microservice within the Gen3 Helm charts can have its values.yaml file located in the <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm" target="_blank">gen3-helm/helm</a> directory of the Git repository. Helm deployment can either be done via configuring charts for individual microservices, or it can utilize the master Gen3 charts. Customizing values in the values.yaml file enables you to tailor microservice configurations, influencing the deployment or update processes of the Helm charts.</p></div><div><p>While there are various methods to deploy Gen3 using Helm charts, this document focuses on presenting the comprehensive master Gen3 Helm chart that includes all necessary microservices, using AWS external secrets for databases and credentials.</p></div><div><p>To update the Gen3 chart, edit the values.yaml file at <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm/gen3" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm/gen3" target="_blank">gen3-helm/helm/gen3</a>. Customize values for specific microservices by naming them. Consult the <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/blob/master/helm/fence/README.md" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/blob/master/helm/fence/README.md" target="_blank">README</a> file in the chart folder to find chart configuration variables.</p></div><div class="heading-wrapper"><h3 data-heading="Gen3 Helm Prerequisites" class="heading" id="Gen3_Helm_Prerequisites"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Gen3 Helm Prerequisites</h3><div class="heading-children"><div><ol>
<li data-line="0">
<p>The first step for our helm installation of Gen3 is to prepare our deployment to authenticate appropriately with AWS Secrets Manager.  </p>
</li>
<li data-line="4">
<p>If you already have a basic helm installed on your computer, execute this <a data-tooltip-position="top" aria-label="https://github.com/occ-data/support-scripts-gen3/blob/chore/add_code_for_helm/gen3-helm/external_secrets.sh" rel="noopener" class="external-link" href="https://github.com/occ-data/support-scripts-gen3/blob/chore/add_code_for_helm/gen3-helm/external_secrets.sh" target="_blank">script - external_secrets.sh</a> from repository support-scripts-gen3 to install the external_values helm chart. This will allow us to use external secrets in helm charts. Below are the input variables required for running the script.</p>
</li>
</ol></div><div><ul>
<li data-line="0">&lt;&gt;: AWS account number in which the commons would spin up<br>
</li>
<li data-line="2">&lt;&gt;: AWS region in which EKS is spun up.<br>
</li>
<li data-line="4">&lt;&gt;: Name for an IAM Policy<br>
</li>
<li data-line="6">&lt;&gt;: Name of IAM user who would be using the above IAM policy to spin up helm charts, the name of secrets_user created in cloud-automation<br>
</li>
<li data-line="8">&lt;&gt;: AWS profile from the local/VM which can access the AWS Account number given, if the profile value is default<br>
</li>
</ul></div><div><p>Note (To-do): We require the AWS Secret Key and Secret Access Key for the IAM user mentioned in this step. These credentials will be utilized in the next step.</p></div><div><ol start="2">
<li data-line="0">Our infrastructure deployment from cloud-automation will have provisioned a “secrets_user” in IAM which is used in the previous step. We want to provide security credentials for this user ahead of time to enable our deployment. This will allow us to authenticate with secrets-manager without maintaining AWS creds in the values file.<br>
</li>
</ol></div><div><pre><code>kubectl create secret generic prelim-aws-config \  
  &nbsp; --from-literal=access-key=’&lt;&lt;aws-access-key-id&gt;&gt;’ \  
  &nbsp; --from-literal=secret-access-key=’&lt;&lt;aws-secret-access-key&gt;&gt;’  
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="2">
<li data-line="0">
<p>The next step is to configure our Authentication service to utilize our desired Identity Provider (Google):</p>
</li>
<li data-line="3">
<p>Visit and modify the <a data-tooltip-position="top" aria-label="https://github.com/occ-data/support-scripts-gen3/blob/feat/fence-config-template/gen3-helm/fence-config-template.yaml" rel="noopener" class="external-link" href="https://github.com/occ-data/support-scripts-gen3/blob/feat/fence-config-template/gen3-helm/fence-config-template.yaml" target="_blank">fence-config-template.yaml</a></p>
</li>
<li data-line="6">
<p>Replace <code>&lt;&lt;your-website-URL&gt;&gt;</code></p>
</li>
<li data-line="8">
<p>Replace <code>&lt;&lt;your-google-client-id&gt;&gt;</code></p>
</li>
<li data-line="10">
<p>Replace<code> &lt;&lt;your-google-client-secret&gt;&gt;</code></p>
</li>
<li data-line="13">
<p>Store the updated configuration in AWS Secrets Manager</p>
</li>
<li data-line="16">
<p>Name the secret <code>&lt;&lt;your-vpc-name&gt;&gt;-fence-config</code></p>
</li>
</ol></div></div></div><div class="heading-wrapper"><h3 data-heading="Gen3 Helm Installation" class="heading" id="Gen3_Helm_Installation"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Gen3 Helm Installation</h3><div class="heading-children"><div><ol>
<li data-line="0">The very first thing we must do is add or clone the Gen3 Helm repository. This is how we package up all the components that make up Gen3 and make them accessible to the public.</li>
</ol></div><div><pre><code>git clone [https://github.com/occ-data/gen3-helm  
](https://github.com/occ-data/gen3-helm)cd gen3-helm/helm
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="2">
<li data-line="0">Once you have your repo added, you can install it with the command</li>
</ol></div><div><pre><code>helm upgrade --install dev ./gen3 -f /path/to/updated/values.yaml
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="3">
<li data-line="0">
<p>Enable access to our deployments over HTTPS by setting up a load balancer that references a valid, signed certificate for your domain.&nbsp; This can be done via two options:  </p>
</li>
<li data-line="4">
<p>(CDTS Official) Gen3 facilitates this process via cloud-automation with the following command:<br>
</p>
</li>
</ol></div><div><pre><code>  gen3 kube-setup-ingress  
</code><button class="copy-code-button">Copy</button></pre></div><div><pre><code>This command will perform a helm installation of the alb-ingress-controller after pre-provisioning IAM roles/policies for the ingress controller, ACL rules for a WAF, etc.  
  
Your deployment should now be available over HTTPS.  
  
Note:&nbsp; We can perform this with more standard tooling such as cert-manager and an ingress controller with a more robust solution/community behind it. (Explained in step b)  
  
  
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="2">
<li data-line="0">
<p>(Alternative to step a)&nbsp; Install an ingress controller (NGINX) to your cluster to provision an ALB.&nbsp; Automate certificate signing requests by installing cert-manager and preparing issuers for your desired Certificate Authority.</p>
</li>
<li data-line="3">
<p>Install NGINX.&nbsp; This will provision an ALB resource in your AWS account<br>
</p>
</li>
</ol></div><div><pre><code>helm upgrade --install ingress-nginx ingress-nginx \  
    &nbsp; --repo https://kubernetes.github.io/ingress-nginx \  
    &nbsp; --namespace ingress-nginx \  
    &nbsp; --create-namespace  
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="2">
<li data-line="0">Install cert-manager.&nbsp; This will automate certificate signing requests<br>
</li>
</ol></div><div><pre><code>  helm repo add jetstack https://charts.jetstack.io \  
   &nbsp; --force-update  
</code><button class="copy-code-button">Copy</button></pre></div><div><pre><code>  helm install &nbsp; cert-manager jetstack/cert-manager \  
   &nbsp; --namespace cert-manager \  
   &nbsp; --create-namespace \  
   &nbsp; --version v1.14.4 \  
   &nbsp; --set installCRDs=true  
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="3">
<li data-line="0">
<p>Create your issuers.&nbsp; For our example, we will use LetsEncrypt</p>
</li>
<li data-line="3">
<p>Staging Certificate (useful for debugging certificate signing requests)</p>
</li>
</ol></div><div><pre><code>kubectl apply -f - &lt;&lt;EOF

apiVersion: cert-manager.io/v1

kind: ClusterIssuer

metadata:

&nbsp;&nbsp;name: letsencrypt-staging

spec:

&nbsp;&nbsp;acme:

&nbsp;&nbsp;&nbsp;&nbsp;email: email@example.com

&nbsp;&nbsp;&nbsp;&nbsp;preferredChain: a&nbsp; &nbsp; privateKeySecretRef:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: letsencrypt-staging

&nbsp;&nbsp;&nbsp;&nbsp;server: https://acme-staging-v02.api.letsencrypt.org/directory

&nbsp;&nbsp;&nbsp;&nbsp;solvers:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- http01:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ingress:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class: nginx

EOF
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="2">
<li data-line="0">Production Certificates (use this once your staging certificate has been successfully signed)</li>
</ol></div><div><pre><code>kubectl apply -f - &lt;&lt;EOF

apiVersion: cert-manager.io/v1

kind: ClusterIssuer

metadata:

&nbsp;&nbsp;name: letsencrypt-prod

spec:

&nbsp;&nbsp;acme:

&nbsp;&nbsp;&nbsp;&nbsp;email: email@example.com

&nbsp;&nbsp;&nbsp;&nbsp;preferredChain: ''

&nbsp;&nbsp;&nbsp;&nbsp;privateKeySecretRef:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name: letsencrypt-prod

&nbsp;&nbsp;&nbsp;&nbsp;server: https://acme-v02.api.letsencrypt.org/directory

&nbsp;&nbsp;&nbsp;&nbsp;solvers:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- http01:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ingress:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class: nginx

EOF
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="3">
<li data-line="0">Running these scripts will allow helm charts to update ingress configuration for revproxy via Helm chart values&nbsp;</li>
</ol></div><div><p>(Note: If you are following the example helm charts provided in the demonstration, The configuration below is already provided <a data-tooltip-position="top" aria-label="https://github.com/occ-data/support-scripts-gen3/blob/84028776ba3a16977fbb6b3efa76547396566c82/gen3-helm/gen3_values.yaml#L668" rel="noopener" class="external-link" href="https://github.com/occ-data/support-scripts-gen3/blob/84028776ba3a16977fbb6b3efa76547396566c82/gen3-helm/gen3_values.yaml#L668" target="_blank">in the chart</a>)  </p></div><div><ol>
<li data-line="0">
<p>For example: in the YAML file for values, Values.revproxy.ingress has the class name nginx with annotations</p>
</li>
<li data-line="3">
<p>cert-manager.io/cluster-issuer:"letsencrypt-prod"</p>
</li>
</ol></div><div><p>This annotation specifies the cluster issuer which we previously deployed</p></div><div><ol start="2">
<li data-line="0">acme.cert-manager.io/http01-edit-in-place: "true"</li>
<li data-line="2"></li>
</ol></div><div><p>revproxy:</p></div><div><p>&nbsp;&nbsp;enabled: true</p></div><div><p>&nbsp;&nbsp;ingress:</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;enabled: true</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;className: "nginx"</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;annotations:</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acme.cert-manager.io/http01-edit-in-place: "true"</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cert-manager.io/cluster-issuer: "letsencrypt-prod"</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;hosts:</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;- host: gen3-demo.cloud.krum.io</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paths:</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- path: /</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pathType: Prefix</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;tls:</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- secretName: cm-gen3-certs-prod</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hosts:</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- gen3-demo.cloud.krum.io</p></div><div><ol start="4">
<li data-line="0">Upon finishing this configuration, you can proceed to deploy the Gen3 Helm charts. We offer a simplified Helm chart with configurations for running a basic Gen3 version. You can find the helm chart in the <a data-tooltip-position="top" aria-label="https://github.com/occ-data/support-scripts-gen3/blob/chore/add_code_for_helm/gen3-helm/gen3_values.yaml" rel="noopener" class="external-link" href="https://github.com/occ-data/support-scripts-gen3/blob/chore/add_code_for_helm/gen3-helm/gen3_values.yaml" target="_blank">helm chart - gen3_values.yaml</a> within the support-scripts-gen3. There are some variables in the charts which are explained in the <a data-tooltip-position="top" aria-label="https://github.com/occ-data/support-scripts-gen3/blob/chore/add_code_for_helm/gen3-helm/README.md#gen3_valuesyaml" rel="noopener" class="external-link" href="https://github.com/occ-data/support-scripts-gen3/blob/chore/add_code_for_helm/gen3-helm/README.md#gen3_valuesyaml" target="_blank">readme</a> file here.&nbsp;</li>
</ol></div><div><p>Details about each microservice deployed in the sample Helm chart are provided after completing step 6. You can customize the Helm chart according to your specific requirements. For more information about available microservices and their configuration, refer to <a data-tooltip-position="top" aria-label="http://configuration.md" rel="noopener" class="external-link" href="http://configuration.md" target="_blank">CONFIGURATION.md</a>, which contains detailed instructions and a comprehensive range of configuration options for each service.</p></div><div><ol start="5">
<li data-line="0">After setting up your Helm environment, either by following the provided example or using the values.yaml file in the gen3-helm directory on your system (located at <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/blob/master/helm/gen3/values.yaml" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/blob/master/helm/gen3/values.yaml" target="_blank">demo-gen3/gen3-helm/helm/gen3/values.yaml</a> for the Gen3 Helm code), you can execute the helm upgrade commands to initiate the Helm process.</li>
</ol></div><div><p>Note: To deploy Gen3 Helm beyond this document, ensure that you have the necessary <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/blob/master/docs/PREREQUISITES.md" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/blob/master/docs/PREREQUISITES.md" target="_blank">prerequisites</a> installed and configured. The following section outlines a set of microservices and instructions for updating the chart to run a basic version of Gen3. For detailed configuration of any unlisted microservices, consult the <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/blob/master/docs/CONFIGURATION.md" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/blob/master/docs/CONFIGURATION.md" target="_blank">configuration documentation</a> for further insights.&nbsp;</p></div><div><p>After making the required updates in the Helm charts or if you wish to apply overrides, you can achieve this by supplying the values.yaml file. (Note: Before executing this command, ensure you are in the demo-gen3/gen3-helm/helm/gen3/ folder. You can confirm your current directory using the pwd command.)  </p></div><div><pre><code>helm upgrade --install dev gen3/gen3 -f ./values.yaml  
</code><button class="copy-code-button">Copy</button></pre></div><div><p>If you want to provide overrides you can do so by passing in one, or several values.yaml files. For example, if you want to pass in user.yaml and fence-config (NB! New format, check out sample files in this <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm/fence/templates" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm/fence/templates" target="_blank">folder</a>)  </p></div><div><pre><code>helm upgrade --install dev gen3/gen3&nbsp; -f values.yaml -f fence-config.yaml -f user.yaml
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Note: Each time you modify the values.yaml file, you need to execute the helm upgrade command to ensure that the changes are applied to both the Helm charts and Kubernetes.</p></div><div><p>Before we start examining the pre-configured file in detail, let's take a look at the list of sub-gen3 helm charts for gen3 microservices that are utilized to set up a basic Gen3 data commons as outlined in this script.</p></div><div><ul>
<li data-line="0">global (this is a helm chart variable, not a gen3 microservice)<br>
</li>
<li data-line="2">arborist<br>
</li>
<li data-line="4">aws-es-proxy<br>
</li>
<li data-line="6">etl<br>
</li>
<li data-line="8">fence<br>
</li>
<li data-line="10">guppy<br>
</li>
<li data-line="12">indexd<br>
</li>
<li data-line="14">peregrine<br>
</li>
<li data-line="16">portal<br>
</li>
<li data-line="18">revproxy<br>
</li>
<li data-line="20">sheepdog</li>
</ul></div></div></div><div class="heading-wrapper"><h3 data-heading="Global" class="heading" id="Global"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Global</h3><div class="heading-children"><div><p>Global configuration to execute helm charts is defined in the global section. This part includes variables needed to connect to various AWS resources like the Postgres database, AWS Certificate, Secrets Manager, etc. It also involves tasks such as fetching the data dictionary, defining GitOps processes, and hosting configurations.</p></div><div><p>The first variable in global is aws in which the secret for AWS credentials is given. The AWS credentials are stored in Kubernetes secret prelim-aws-config&nbsp;</p></div><div><pre><code>aws:

&nbsp;&nbsp;&nbsp;enabled: true

&nbsp;&nbsp;&nbsp;useLocalSecret:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enabled: true

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;localSecretName: prelim-aws-config&nbsp;&nbsp;
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Note: All database credentials are stored in AWS Secrets manager with the naming convention of&nbsp; {{environment}}-{{service}}-creds, these secrets are then <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/blob/master/helm/common/templates/_external_secrets.tpl#L1-L10" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/blob/master/helm/common/templates/_external_secrets.tpl#L1-L10" target="_blank">fetched</a> and stored into the Kubernetes secrets because of the flag externalSecrets set to yes. As shown in the configuration below, postgres db and external secrets are enabled.</p></div><div><pre><code>postgres:

&nbsp;&nbsp;dbCreate: true

externalSecrets:

&nbsp;&nbsp;deploy: true
</code><button class="copy-code-button">Copy</button></pre></div><div><p>The host configuration is also part of the global chart,&nbsp;</p></div><div><ul>
<li data-line="0">Dev: The value "yes" or "no" in the development environment setting determines whether Postgres and Elasticsearch should be deployed or not.<br>
</li>
<li data-line="2">Environment:&nbsp; name of the VPC/environment<br>
</li>
<li data-line="4">Hostname: URL of gen3 data commons without http:// or https:// (point 5 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)<br>
</li>
<li data-line="6">revproxyArn: ARN of the certificate for the domain/website, (point 7 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)<br>
</li>
<li data-line="8">dictionaryUrl: S3 URL from which data dictionary will be fetched</li>
</ul></div><div><pre><code>dev: false

environment: &lt;&lt;your-vpc-name&gt;&gt;

hostname: &lt;&lt;your-website-URL&gt;&gt;

revproxyArn: arn:aws:acm:us-east-1:XXXXXXXXXX:certificate/XXXXXXXXX # &lt;&lt;your-website-aws-certificate-arn&gt;&gt;

dictionaryUrl: https://s3.amazonaws.com/XXXXXXXX/XXXXX/XXXXXXXX/XXXX.json&nbsp; # &lt;&lt;your-data-dictionary-URL&gt;&gt;

portalApp: gitops

publicDataSets: true
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Alongside these, the other values are also required for the global helm chart for gen3, the description of these values is provided <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm/gen3" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm/gen3" target="_blank">here</a></p></div><div><pre><code>tierAccessLevel: libre

tierAccessLimit: "1000"

netPolicy: true

dispatcherJobNum: 10

ddEnabled: false

manifestGlobalExtraValues:

&nbsp;&nbsp;fence_url: https://&lt;&lt;your-website-URL&gt;&gt;/user
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="Arborist" class="heading" id="Arborist"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Arborist</h3><div class="heading-children"><div><p>Arborist is a key part of the Gen3 stack, managing access control through policies, roles, and resources. It organizes resources hierarchically and grants permissions based on defined roles.&nbsp; In the Gen3 stack, the arborist works closely with the fence, which handles user authentication and issues JWT tokens containing authorization policies. Other services can check user authorization by sending the JWT to an arborist, ensuring secure access control without storing user credentials. The arborist is an open-source microservice and can be located on its git code base <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/arborist" rel="noopener" class="external-link" href="https://github.com/uc-cdis/arborist" target="_blank">here</a></p></div><div><p>In helm charts, the arborist helm chart can be deployed either as an entity or part of gen3 helm charts. The list of values for helm chart arborist can be found <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm/arborist#values" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm/arborist#values" target="_blank">here</a></p></div><div><p>To use Arborist in Helm, the basic variables are to enable the service and give database credentials. Since we have database secrets stored in AWS Secrets Manager, the only thing needed in our version of the helm chart is to enable arborist.</p></div><div><pre><code>arborist:

&nbsp;&nbsp;enabled: true
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="Aws-es-proxy" class="heading" id="Aws-es-proxy"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Aws-es-proxy</h3><div class="heading-children"><div><p><a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/aws-es-proxy" rel="noopener" class="external-link" href="https://github.com/uc-cdis/aws-es-proxy" target="_blank">aws-es-proxy</a> is a small web server application sitting between your HTTP client (browser, curl, etc...) and Amazon Elasticsearch service. This service is responsible for connecting the elastic search to gen3.&nbsp;</p></div><div><p>Aws-es-proxy can be deployed as an <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm/aws-es-proxy" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm/aws-es-proxy" target="_blank">individual chart</a> or as a part of the gen3 helm chart. In the example helm chart, aws-es-proxy would need to be enabled, and elastic search endpoint should be provided</p></div><div><p>aws-es-proxy:</p></div><div><p>&nbsp;&nbsp;enabled: true</p></div><div><p>&nbsp;&nbsp;esEndpoint: &lt;&gt;</p></div><div><p>&nbsp;externalSecrets:</p></div><div><p>&nbsp;&nbsp;&nbsp;awsCreds: &lt;&gt;-aws-es-proxy-creds</p></div></div></div><div class="heading-wrapper"><h3 data-heading="ETL" class="heading" id="ETL"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>ETL</h3><div class="heading-children"><div><p>ETL helm sub chart in Gen3 helm contains etl configuration to tables and fields to ETL to ElasticSearch. The field mapping to get values from the graph model into elastic search with transformation. As shown below, the ETL helm chart contains esEndpoint to local cluster (this is localized due to aws-es-proxy) and etlMapping to show mappings to graph model and transformation of values (i.e gender and race)</p></div><div><pre><code>etl:

&nbsp;&nbsp;enabled: true

&nbsp;&nbsp;esEndpoint: elasticsearch.default.svc.cluster.local

&nbsp;&nbsp;etlMapping:

&nbsp;&nbsp;&nbsp;&nbsp;mappings:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: dev_case

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc_type: case

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type: aggregator

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root: case

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;props:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: submitter_id

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: project_id

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flatten_props:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- path: demographics

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;props:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: gender

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_mappings:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- female: F

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- male: M

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: race

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value_mappings:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- american indian or alaskan native: Indian

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: ethnicity

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: year_of_birth

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aggregated_props:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- name: _samples_count

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;path: samples

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fn: count
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="Fence" class="heading" id="Fence"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Fence</h3><div class="heading-children"><div><p>Fence microservice provides an authentication and authorization framework for all Gen3 services &amp; resources. The fence separates protected resources from the outside world, allowing only trusted entities to enter. The fence is an open-source Gen3 microservice whose git code base can be found <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/fence" rel="noopener" class="external-link" href="https://github.com/uc-cdis/fence" target="_blank">here</a></p></div><div><p>This document would only focus on deploying the basic configuration of the fence. The helm deployment configuration for the fence can be found <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm/fence" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm/fence" target="_blank">in gen3-helm github</a>. This link consists of the table with details about all the variables defined for further development.</p></div><div><p>In the basic configuration of the fence helm chart which is shown below, the image of the microservice is defined. The image needs to be updated periodically as microservices are constantly changing. Alongside the external secret defined for fence db with the naming convention of&nbsp; {{environment}}-{{service}}-creds, and fence-config secret, Other externalSecrets are given such as&nbsp;</p></div><div><ul>
<li data-line="0">createK8sFenceConfigSecret: this will create the Helm fence-config secret<br>
</li>
<li data-line="2">createK8sJwtKeysSecret: this will create the Helm fence-jwt-keys secret<br>
</li>
<li data-line="4">createK8sGoogleAppSecrets: this will create the Helm fence-google-app-creds-secret and fence-google-storage-creds-secret secrets</li>
</ul></div><div><pre class="language-yaml" tabindex="0"><code class="language-yaml is-loaded"><span class="token key atrule">fence</span><span class="token punctuation">:</span>

  enabled<span class="token punctuation">:</span> <span class="token boolean important">true</span>

  image<span class="token punctuation">:</span>

    tag<span class="token punctuation">:</span> <span class="token number">2024.04</span>

  externalSecrets<span class="token punctuation">:</span>

  fenceConfig<span class="token punctuation">:</span> &lt;&lt;your<span class="token punctuation">-</span>vpc<span class="token punctuation">-</span>name<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">-</span>fence<span class="token punctuation">-</span>config

    createK8sFenceConfigSecret<span class="token punctuation">:</span> <span class="token boolean important">false</span>

    createK8sJwtKeysSecret<span class="token punctuation">:</span> <span class="token boolean important">true</span>

    createK8sGoogleAppSecrets<span class="token punctuation">:</span> <span class="token boolean important">true</span>

  USER_YAML<span class="token punctuation">:</span> <span class="token punctuation">|</span>
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="User YAML Here" class="heading" id="User_YAML_Here"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>User YAML Here</h3><div class="heading-children"></div></div><div class="heading-wrapper"><h3 data-heading="Guppy" class="heading" id="Guppy"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Guppy</h3><div class="heading-children"><div><p><a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/guppy" rel="noopener" class="external-link" href="https://github.com/uc-cdis/guppy" target="_blank">Guppy</a> is a server that supports GraphQL queries on data from Elasticsearch. Guppy can be set up either as a <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm/guppy" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm/guppy" target="_blank">standalone helm chart</a> or as part of the gen3-helm setup. In the basic script we're showcasing here, the outline of the configuration details for Guppy is below. The esEndpoint for elastic search is given alongside the indices, make sure that the name of indices matches the name of mapping in etlMapping</p></div><div><pre><code>guppy:

&nbsp;&nbsp;enabled: true

&nbsp;&nbsp;image:

&nbsp;&nbsp;&nbsp;&nbsp;tag: 2024.04&nbsp;

&nbsp;&nbsp;esEndpoint: http://elasticsearch.default.svc.cluster.local:9200

&nbsp;&nbsp;indices:

&nbsp;&nbsp;- index: dev_case

&nbsp;&nbsp;&nbsp;&nbsp;type: case
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="Indexd" class="heading" id="Indexd"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Indexd</h3><div class="heading-children"><div><p><a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/indexd" rel="noopener" class="external-link" href="https://github.com/uc-cdis/indexd" target="_blank">Indexd</a> is a hash-based data indexing and tracking service providing 128-bit globally unique identifiers. It is designed to be accessed via a REST-like API or a client. It supports distributed resolution with a central resolver talking to other Indexd servers.</p></div><div><p>Indexd can be a <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm/indexd" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm/indexd" target="_blank">standalone helm chart</a> or part of Gen3 helm configuration. In the provided script, createK8sServiceCredsSecret is given to create the indexd-service-creds secret. This service also uses external secret defined for db with the naming convention of&nbsp; {{environment}}-{{service}}-creds.</p></div><div><pre><code>indexd:

&nbsp;&nbsp;enabled: true

&nbsp;&nbsp;image:

&nbsp;&nbsp;&nbsp;&nbsp;tag: 2024.04&nbsp;

&nbsp;&nbsp;externalSecrets:

&nbsp;&nbsp;&nbsp;&nbsp;createK8sServiceCredsSecret: true

&nbsp;&nbsp;defaultPrefix: &lt;&lt;your-index-prefix&gt;&gt;

  
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="Peregrine" class="heading" id="Peregrine"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Peregrine</h3><div class="heading-children"><div><p><a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/Peregrine" rel="noopener" class="external-link" href="https://github.com/uc-cdis/Peregrine" target="_blank">Peregrine</a> provides a query interface to get insights into data in Gen3 Commons. It mostly works with the Postgres database to perform queries. This microservice can be implemented as a <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm/peregrine" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm/peregrine" target="_blank">stand-alone helm chart</a> or part of the Gen3 Helm chart. The code snippet below shows how peregrine is included in the helm chart used for demonstration today. This script has arboristUrl which allows the peregrine to talk to the arborist.</p></div><div><p>peregrine:</p></div><div><p>&nbsp;&nbsp;enabled: true</p></div><div><p>&nbsp;&nbsp;image:</p></div><div><p>&nbsp;&nbsp;&nbsp;&nbsp;tag: 2024.04</p></div><div><p>&nbsp;&nbsp;arboristUrl: http://arborist-service</p></div></div></div><div class="heading-wrapper"><h3 data-heading="Portal" class="heading" id="Portal"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Portal</h3><div class="heading-children"><div><p>The <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/data-portal" rel="noopener" class="external-link" href="https://github.com/uc-cdis/data-portal" target="_blank">portal</a> microservice is responsible for spinning up the UI front of the website and also supports some basic interaction with Gen3. You can customize the logo, the colors, what elements are to be shown in the UI, and many more using the <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/data-portal/blob/master/docs/portal_config.md#the-portal-config-file" rel="noopener" class="external-link" href="https://github.com/uc-cdis/data-portal/blob/master/docs/portal_config.md#the-portal-config-file" target="_blank">gitops configuration</a> in the portal microservice. The portal can be an <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm/portal" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm/portal" target="_blank">individual helm chart</a> or part of the Gen3 helm chart. The code snippet below shows the configuration for the portal. In gitops, you can give the base64 encoded code for the favicon image &lt;&gt; and logo &lt;&gt; for Gen3 Commons. The json portion consists of gitops json which can have the format <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/data-portal/blob/master/docs/portal_config.md#the-portal-config-file" rel="noopener" class="external-link" href="https://github.com/uc-cdis/data-portal/blob/master/docs/portal_config.md#the-portal-config-file" target="_blank">described in the link here</a></p></div><div><pre class="language-json" tabindex="0"><code class="language-json is-loaded">portal<span class="token operator">:</span>

  enabled<span class="token operator">:</span> <span class="token boolean">true</span>

  image<span class="token operator">:</span>

    tag<span class="token operator">:</span> <span class="token number">2023.04</span>   

  gitops<span class="token operator">:</span>

    favicon<span class="token operator">:</span> &lt;&lt;base<span class="token number">-64</span>-of-favicon-image&gt;&gt;

    logo<span class="token operator">:</span> &lt;&lt;base<span class="token number">-64</span>-of-logo-image&gt;&gt;

    json<span class="token operator">:</span> | 
</code><button class="copy-code-button">Copy</button></pre></div><div class="heading-wrapper"><h5 data-heading="JSON HERE" class="heading" id="JSON_HERE"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>JSON HERE</h5><div class="heading-children"></div></div></div></div><div class="heading-wrapper"><h3 data-heading="Revproxy" class="heading" id="Revproxy"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Revproxy</h3><div class="heading-children"><div><p>Revproxy is a core service to a commons that handles networking within the Kubernetes cluster. Revproxy is an NGINX container managing cluster endpoints. Revproxy is a vital nginx container that stores cluster endpoint data, requiring a setup of endpoints to enable traffic routing and normal operation. Revproxy can be an independent <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/tree/master/helm/revproxy" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/tree/master/helm/revproxy" target="_blank">helm deployment</a> or part of the Gen3 helm chart as shown below with a snippet for the demonstration helm chart.&nbsp;</p></div><div><p>The configuration here has nginx className, multiple annotations, hosts, and tls configurations to import the certificate from the AWS certificate manager to spin up load balancers (ALB- application load balancer) to run the Gen3 Commons</p></div><div><p><code>&nbsp; acme.cert-manager.io/http01-edit-in-place: "true" </code></p></div><div><p><code>&nbsp;cert-manager.io/cluster-issuer: "letsencrypt-prod"</code></p></div><div><pre><code>
revproxy:

&nbsp;&nbsp;enabled: true

&nbsp;&nbsp;ingress:

&nbsp;&nbsp;&nbsp;&nbsp;enabled: true

&nbsp;&nbsp;&nbsp;&nbsp;className: "nginx"

&nbsp;&nbsp;&nbsp;&nbsp;annotations:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acme.cert-manager.io/http01-edit-in-place: "true"

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cert-manager.io/cluster-issuer: "letsencrypt-prod"

&nbsp;&nbsp;&nbsp;&nbsp;hosts:

&nbsp;&nbsp;&nbsp;&nbsp;- host: &lt;&lt;your-website-URL&gt;&gt;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paths:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- path: /

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pathType: Prefix

&nbsp;&nbsp;&nbsp;&nbsp;tls:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- secretName: cm-gen3-certs-prod&nbsp; &nbsp; &nbsp; &nbsp; # pragma: allowlist secret

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hosts:

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &lt;&lt;your-website-URL&gt;&gt;
</code><button class="copy-code-button">Copy</button></pre></div></div></div><div class="heading-wrapper"><h3 data-heading="Sheepdog" class="heading" id="Sheepdog"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Sheepdog</h3><div class="heading-children"><div><p><a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/sheepdog" rel="noopener" class="external-link" href="https://github.com/uc-cdis/sheepdog" target="_blank">Sheepdog</a> is a core service that handles data submission. Data gets submitted to the commons, using the dictionary as a schema, which is reflected within the sheepdog database. Sheepdog has the configuration to connect to fenceUrl to check user permissions for data submission, also it has volumeMounts for volumes to mount to the container which takes configurations from the <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/gen3-helm/blob/master/helm/sheepdog/sheepdog-secret/wsgi.py" rel="noopener" class="external-link" href="https://github.com/uc-cdis/gen3-helm/blob/master/helm/sheepdog/sheepdog-secret/wsgi.py" target="_blank">wsgi.py</a> file</p></div><div><pre><code>  

sheepdog:

&nbsp;&nbsp;enabled: true

&nbsp;&nbsp;image:

&nbsp;&nbsp;&nbsp;&nbsp;tag: 2024.04&nbsp;

&nbsp;&nbsp;fenceUrl: https://&lt;&lt;your-website-URL&gt;&gt;/user

&nbsp;&nbsp;volumeMounts:

&nbsp;&nbsp;- name: "config-volume"

&nbsp;&nbsp;&nbsp;&nbsp;readOnly: true

&nbsp;&nbsp;&nbsp;&nbsp;mountPath: "/var/www/sheepdog/settings.py"

&nbsp;&nbsp;&nbsp;&nbsp;subPath: "wsgi.py"
</code><button class="copy-code-button">Copy</button></pre></div><div><p>**</p></div></div></div></div></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 12; transform: translate(2893px, -4014px); width: 1194px; height: 1634px; --canvas-node-width: 1194px; --canvas-node-height: 1634px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>**</p></div><div class="heading-wrapper"><h2 data-heading="Step 1: Set up VM allowing access to AWS Account and Gen3 cloud-automation" class="heading" id="Step_1:_Set_up_VM_allowing_access_to_AWS_Account_and_Gen3_cloud-automation"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Step 1: Set up VM allowing access to AWS Account and Gen3 cloud-automation</h2><div class="heading-children"><div><p>Before we do Gen3 setup, a bunch of permissions need to be set up for access to AWS from local/any virtual system which can be used to spin up, monitor, and maintain all the resources. We are creating a VM that would be responsible for running the operations for Gen3.</p></div><div><p>OCC and the Kurmware team have created a Git repository supporting scripts that would be useful for spinning up Gen3 commons. <code>clone the support-scripts-gen3 git repository into this newly created folder on your local</code>. Make sure you are inside the <code>demo-gen3 folder</code> before executing the command&nbsp;</p></div><div><pre><code>git clone --quiet [https://github.com/occ-data/support-scripts-gen3.git](https://github.com/occ-data/support-scripts-gen3.git)&nbsp;
</code><button class="copy-code-button">Copy</button></pre></div><div><pre><code>cd gen3-admin-vm
</code><button class="copy-code-button">Copy</button></pre></div><div><p>After you've cloned the Git repository, go into the <code>gen3-admin-vm</code> folder. There, you'll find the Terraform module to deploy an adminVM in your AWS account. Make sure to follow these steps to spin up the VM using Terraform.</p></div><div><ol>
<li data-line="0">
<p>Setting up variables in config.tf file: You need to set up variables in CM</p>
</li>
<li data-line="3">
<p>prefix = “the name of your VM” (VM name from Point 3 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</p>
</li>
<li data-line="5">
<p>ssh_allowed_ips = [“list of IP addresses allowed to SSH in the VM”] &nbsp;(Point 13 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</p>
</li>
<li data-line="7">
<p>aws_cli_profile = “name of the aws profile on your local machine” (Point 4 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked, demo-gen3-aws for this example)</p>
</li>
<li data-line="9">
<p>aws_region = “aws region in which you want your VM in”  </p>
</li>
<li data-line="13">
<p>Once the variables are configured, you can run the Terraform scripts to implement the VM.&nbsp;</p>
</li>
<li data-line="16">
<p>The first command is to initialize terraform from the root directory of <code>gen3-admin-vm</code>,&nbsp; This command will initiate the terraform with the required module configurations.</p>
</li>
</ol></div><div><pre><code>terraform init  
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="2">
<li data-line="0">Once the terraform is initialized, we run the plan command to determine the status of current resources or the list of new resources to be spun up.<br>
</li>
</ol></div><div><pre><code>terraform plan -out “plan” 
</code><button class="copy-code-button">Copy</button></pre></div><div><ol start="3">
<li data-line="0">Check the output on the terraform plan on your screen and if everything looks okay, you can apply the terraform plan to spin up the resources for the VM</li>
</ol></div><div><pre><code>terraform apply plan
</code><button class="copy-code-button">Copy</button></pre></div><div><p>The terraform script spins up a VPC for adminVM, with Ubuntu EC2 (Configurable with options) and IAM roles with SSH keys for ssh_allowed_ips IP address. The terraform also executes a provisioner script that will install the necessary packages and clone needed git repository required for running Gen3 using Helm.&nbsp;&nbsp;</p></div><div><p>Note: For this demonstration, we will be using a fork of gen3-helm and cloud-automation created by OCC and the Krumware team. Once the changes made for this are merged into the master, we will update this documentation accordingly.</p></div><div><p>The output for Terraform is stored in the outputs folder on your local in a text file (named &lt;&gt;-info.txt) with information about VPC that will be used in further steps to connect the VM to Gen3. The value of VM Public IP in the text file is the IP address for your VM. The folder also has SSH keys for the VM.  </p></div><div><p>Once Terraform has successfully run, you need to give the following command from your local to connect to the VM (assuming you are in the <a data-tooltip-position="top" aria-label="https://github.com/occ-data/support-scripts-gen3.git" rel="noopener" class="external-link" href="https://github.com/occ-data/support-scripts-gen3.git" target="_blank">support-scripts-gen3</a> folder)</p></div><div><pre><code>ssh -o IdentitiesOnly=yes -i outputs/&lt;&lt;prefix&gt;&gt;.pem ubuntu@&lt;&lt;VM Public IP&gt;&gt;  
</code><button class="copy-code-button">Copy</button></pre></div><div><p><code>Where outputs/&lt;&lt;prefix&gt;&gt;.pem is the location of the SSH key in the outputs folder</code></p></div><div><p>, and&nbsp;</p></div><div><p><code>&lt;&lt;VM Public IP&gt;&gt; is the IP address in &lt;&lt;prefix&gt;&gt;-info.txt</code></p></div><div><p>**</p></div></div></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 13; transform: translate(4173px, -4014px); width: 1640px; height: 3480px; --canvas-node-width: 1640px; --canvas-node-height: 3480px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>**</p></div><div class="heading-wrapper"><h2 data-heading="Step 2: Spin up VPC" class="heading" id="Step_2:_Spin_up_VPC"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Step 2: Spin up VPC&nbsp;</h2><div class="heading-children"><div><p>In this step, we would execute the commands to set up VPC and squid instances for our Gen3 in EC2 as main components with other required AWS resources using cloud automation scripts and Gen3 commands. This step would require the following variables out of the variable/setup information mentioned above  </p></div><div><ol>
<li data-line="0">Name of AWS profile (defined in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.z4t3fx1e5qy2" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.z4t3fx1e5qy2" target="_blank">step 1</a> above, Point 4 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</li>
<li data-line="2">Name of VPC (Point 3 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</li>
<li data-line="4">ACM certificate ARN (Point 7 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</li>
<li data-line="6">OAuth Client ID and Client Secret (Point 8 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</li>
<li data-line="8">SSH key to access Kubernetes (Created in Step 1 above)</li>
<li data-line="10">VPC CIDR (Point 10 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</li>
<li data-line="12">Another VPC ID and CIDR can be used to access the system (Point 12 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</li>
<li data-line="14">Name of Indexd prefix for Gen3 data commons (Point 9 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</li>
<li data-line="16">Name of the Gen3 Data commons (Point 5 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</li>
</ol></div><div><p>Note: Make sure your terraform is on version 0.11.5 to use this script. To create VPC and resources, I’d be performing the following steps with demo-gen3 VPC name and demo-gen3-aws AWS profile</p></div><div><ul>
<li data-line="0">Initialize the base module to run terraform to spin up VPC using the gen3 workon command. Gen3’s workon command sets up a terraform workspace folder for a given AWS profile and infrastructure type (for example, commons VPC, VPN server, data bucket). Ensure your ~/.bashrc changes made in step 1 are present and that ~/.bashrc is sourced. You can use this command anytime to access the Terraform backend. Generally, the command follows the syntax of gen3 workon &lt;&gt; &lt;&gt; but for this instance, I would be executing the following command,<br>
</li>
</ul></div><div><pre><code>gen3 workon demo-gen3-aws demo-gen3
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Once the terraform is successfully initialized, You will see the message showing Terraform is successfully initialized&nbsp;</p></div><div><p><img src="https://lh7-us.googleusercontent.com/VOyBnXdrI-xH031yJiM84XYv7cyz6vUOfQFGP4lyA8pesorP468Bfsz8HytcXLchIldPHTnjpH6zq1sjvyE1U7SFCupUxmUPfwArXBPVH6yCHkCShp3gYuaoY_Z19YMBWbobtPCNZUpCgYk-" referrerpolicy="no-referrer"></p></div><div><p>Note: Please refer to this section of <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.feoqfbx1eedq" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.feoqfbx1eedq" target="_blank">Solutions</a> if you face any challenge in getting a successful output</p></div><div><ul>
<li data-line="0">Give the following command to access the terraform files of the VPC by following the command</li>
</ul></div><div><pre><code>gen3 cd
</code><button class="copy-code-button">Copy</button></pre></div><div><p>&amp; then </p></div><div><pre><code>ls
</code><button class="copy-code-button">Copy</button></pre></div><div><p>The ls command will show the list of VPC config files with an extension of tfvars and many more  </p></div><div><ul>
<li data-line="0">Open config.tfvars and change the following variables. The explanation for each variable is explained <a data-tooltip-position="top" aria-label="https://github.com/uc-cdis/cloud-automation/tree/master/tf_files/aws/commons" rel="noopener" class="external-link" href="https://github.com/uc-cdis/cloud-automation/tree/master/tf_files/aws/commons" target="_blank">here</a></li>
</ul></div><div style="overflow-x: auto;"><table>
<thead>
<tr>
<th>Variable name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>vpc_name  <br>(point 3 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</td>
<td>demo-gen3</td>
</tr>
<tr>
<td>vpc_cidr_block  <br>(point 10 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</td>
<td>172.168.X.X/16</td>
</tr>
<tr>
<td>aws_cert_name  <br>(point 7 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</td>
<td>arn:aws:ACM:us-east-1:XXXXXXXXX:certificate/asdaf-asfafa-asfca-af-asfada-da-v</td>
</tr>
<tr>
<td>csoc_managed</td>
<td>false</td>
</tr>
<tr>
<td>csoc_account_id</td>
<td>Remove lines with these variables</td>
</tr>
<tr>
<td>peering_cidr  <br>(point 12 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</td>
<td>172.168.X.0/16</td>
</tr>
<tr>
<td>peering_vpc_id  <br>(point 12 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</td>
<td>vpc-XXXXXXXXXX</td>
</tr>
<tr>
<td>squid-nlb-endpointservice-name</td>
<td>Remove lines with these variables</td>
</tr>
<tr>
<td>deploy_single_proxy</td>
<td>false</td>
</tr>
<tr>
<td>indexd_prefix  <br>(point 9 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</td>
<td>dg.XXXX</td>
</tr>
<tr>
<td>hostname  <br>(point 5 in <a data-tooltip-position="top" aria-label="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" rel="noopener" class="external-link" href="https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.qagejhrvhf37" target="_blank">Variables</a> asked)</td>
<td>demo-gen3.occ-pla.net</td>
</tr>
<tr>
<td>kube_ssh_key  <br>(the ssh key was created in step 1)</td>
<td>ssh-rsa AJCI629-23rncbhzyca0irl23riaisk7301bhxtakmcirhkngwGHIUbj7ulIHugjpq3i973gqu hbfkncc</td>
</tr>
<tr>
<td>google_client_id</td>
<td>XXXXXXXX.apps.googleusercontent.com</td>
</tr>
<tr>
<td>google_client_secret</td>
<td>Hklihg-tkjkj-468bl-76</td>
</tr>
<tr>
<td>config_folder</td>
<td>demo-gen3</td>
</tr>
<tr>
<td>fence_engine_version</td>
<td>13.7</td>
</tr>
<tr>
<td>sheepdog_engine_version</td>
<td>13.7</td>
</tr>
<tr>
<td>indexd_engine_version</td>
<td>13.7</td>
</tr>
<tr>
<td>gdcapi_indexd_password</td>
<td>If empty, Create a random 32-digit string for each one of these by either using cat /dev/urandom | base64 | head -c 32 (Make sure this string has no special characters)</td>
</tr>
<tr>
<td>db_password_fence</td>
<td></td>
</tr>
<tr>
<td>db_password_gdcapi</td>
<td></td>
</tr>
<tr>
<td>db_password_peregrine</td>
<td></td>
</tr>
<tr>
<td>db_password_sheepdog</td>
<td></td>
</tr>
<tr>
<td>db_password_indexd</td>
<td></td>
</tr>
<tr>
<td>hmac_encryption_key</td>
<td></td>
</tr>
</tbody>
</table></div><div><ul>
<li data-line="0">Once the variables are set up, you use the following commands to terraform plan and apply them to compile and run terraform<br>
</li>
</ul></div><div><pre><code>gen3 tfplan
</code><button class="copy-code-button">Copy</button></pre></div><div><p>This command is equivalent to terraform plan which validates the configuration and creates an execution plan, which lets you preview the changes that Terraform plans to make to your infrastructure  </p></div><div><pre><code>gen3 tfapply  
</code><button class="copy-code-button">Copy</button></pre></div><div><p>This command is equivalent to <code>terraform apply</code> which command executes the actions proposed in a Terraform plan to create gen3 infrastructure.</p></div><div><ul>
<li data-line="0">If you run into any errors, please fine-tune the values in the <code>config.tfvars file</code> and re-run the </li>
</ul></div><div><pre><code>gen3 tfplan
</code><button class="copy-code-button">Copy</button></pre></div><div><p>and </p></div><div><pre><code>gen3 tfapply
</code><button class="copy-code-button">Copy</button></pre></div><div><p>command  </p></div><div><ul>
<li data-line="0">This terraform script can take about 20-40 min to execute depending on the network and system, once the terraform runs successfully, you will see the following output. Please note down all the values under Outputs with you for future reference.<br>
</li>
</ul></div><div><p><img src="https://lh7-us.googleusercontent.com/5ABBmC6CoSTwaGH0WMl7XBxG4n1J4E_TJEAw1teAOyYO5Djuk8aJnf2W2IfbEmzBFmdFCmzz8nN-3B0rpi-KPsu_0jgOjvQP-cj8D1Op9pUAdItP_X117db_QWI75D_6mMaws_CtyKpKpfmZ" referrerpolicy="no-referrer"></p></div><div><p>**</p></div></div></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 14; transform: translate(-426px, -7440px); width: 2560px; height: 1840px; --canvas-node-width: 2560px; --canvas-node-height: 1840px;"><div class="canvas-node-container"><div class="canvas-node-content node-insert-event"></div><div class="canvas-node-content-blocker"></div></div><div class="canvas-node-label">https://docs.google.com/presentation/d/12tiPsxnK3ZkVY0F5JIQSFOBpN4YFew-9IYsTi4MEcg8/edit#slide=id.g2c23222fc41_0_1050</div></div><div class="canvas-node" style="z-index: 15; transform: translate(-426px, -5417px); width: 1894px; height: 3143px; --canvas-node-width: 1894px; --canvas-node-height: 3143px;"><div class="canvas-node-container"><div class="canvas-node-content node-insert-event"></div><div class="canvas-node-content-blocker"></div></div><div class="canvas-node-label">https://docs.google.com/document/d/16MI-WW7i-HXK3SQ9zUoqFqzHduSDqjmwwrNfgzFdvAQ/edit#heading=h.p5qx3zz6mp07</div></div><div class="canvas-node" style="z-index: 16; transform: translate(4000px, -6680px); width: 904px; height: 840px; --canvas-node-width: 904px; --canvas-node-height: 840px;"><div class="canvas-node-container"><div class="canvas-node-content markdown-embed"><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered"><div class="markdown-preview-sizer markdown-preview-section"><div><p>**</p></div><div class="heading-wrapper"><h2 data-heading="Assumption" class="heading" id="Assumption"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Assumption</h2><div class="heading-children"><div><p>Assuming you have some basic knowledge and tools ready:  </p></div><div><ul>
<li data-line="0">AWS Basics: You know about basic AWS services like VPC (Virtual Private Cloud), EC2 (Elastic Compute Cloud), S3 (Simple Storage Service), IAM (Identity and Access Management), and EKS (Elastic Kubernetes Service).<br>
</li>
<li data-line="2">AWS CLI: You're familiar with the AWS Command Line Interface (CLI) and how to use it to interact with AWS services from your terminal. Make sure you have an updated version of aws<br>
</li>
<li data-line="4">Terraform: You understand how to use Terraform, a tool for automating infrastructure provisioning, to manage AWS resources. You should have Terraform version 0.11.15&nbsp;<br>
</li>
<li data-line="6">AWS Account: You have an AWS account with admin permissions to create and manage resources.<br>
</li>
<li data-line="8">Helm: You have Helm installed on your system and know the basics of using it for deploying and managing applications on Kubernetes.<br>
</li>
<li data-line="10">Kubernetes Knowledge: You know how to work with Kubernetes, including deploying applications and troubleshooting issues. Make sure you have an updated version of kubectl<br>
</li>
<li data-line="12">Git Basics: You are familiar with basic Git commands for version control.<br>
</li>
<li data-line="14">Python Installed: Your system has Python version 3.8 or later installed.</li>
</ul></div><div><p>Given these assumptions, you're ready to work with Gen3 in a development or production environment. This foundation will help you deploy, manage, and troubleshoot applications effectively across Gen3 environments.</p></div><div><p>**</p></div></div></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div></div><div class="canvas-node-content-blocker"></div></div></div><div class="canvas-node" style="z-index: 17; transform: translate(2556px, -2315px); width: 1531px; height: 1781px; --canvas-node-width: 1531px; --canvas-node-height: 1781px;"><div class="canvas-node-container"><div class="canvas-node-content node-insert-event"></div><div class="canvas-node-content-blocker"></div></div><div class="canvas-node-label">https://dry-run.occ-pla.net/login</div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="occ-gen3-x-krumware.html#Solutions"><div class="tree-item-contents heading-link" heading-name="Solutions"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Solutions</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Possible_Issues_for_spinning_up_VPC"><div class="tree-item-contents heading-link" heading-name="Possible Issues for spinning up VPC"><span class="tree-item-title">Possible Issues for spinning up VPC</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#How_to_Update_AWS_and_Kubectl"><div class="tree-item-contents heading-link" heading-name="How to Update AWS and Kubectl"><span class="tree-item-title">How to Update AWS and Kubectl</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="occ-gen3-x-krumware.html#Objective"><div class="tree-item-contents heading-link" heading-name="Objective"><span class="tree-item-title">Objective</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="occ-gen3-x-krumware.html#Step_3:_Spin_up_EKS"><div class="tree-item-contents heading-link" heading-name="Step 3: Spin up EKS"><span class="tree-item-title">Step 3: Spin up EKS</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="occ-gen3-x-krumware.html#Step_4:_Helm_charts_to_implement_Gen3"><div class="tree-item-contents heading-link" heading-name="Step 4: Helm charts to implement Gen3"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Step 4: Helm charts to implement Gen3</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Gen3_Helm_Prerequisites"><div class="tree-item-contents heading-link" heading-name="Gen3 Helm Prerequisites"><span class="tree-item-title">Gen3 Helm Prerequisites</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Gen3_Helm_Installation"><div class="tree-item-contents heading-link" heading-name="Gen3 Helm Installation"><span class="tree-item-title">Gen3 Helm Installation</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Global"><div class="tree-item-contents heading-link" heading-name="Global"><span class="tree-item-title">Global</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Arborist"><div class="tree-item-contents heading-link" heading-name="Arborist"><span class="tree-item-title">Arborist</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Aws-es-proxy"><div class="tree-item-contents heading-link" heading-name="Aws-es-proxy"><span class="tree-item-title">Aws-es-proxy</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#ETL"><div class="tree-item-contents heading-link" heading-name="ETL"><span class="tree-item-title">ETL</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Fence"><div class="tree-item-contents heading-link" heading-name="Fence"><span class="tree-item-title">Fence</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#User_YAML_Here"><div class="tree-item-contents heading-link" heading-name="User YAML Here"><span class="tree-item-title">User YAML Here</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Guppy"><div class="tree-item-contents heading-link" heading-name="Guppy"><span class="tree-item-title">Guppy</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Indexd"><div class="tree-item-contents heading-link" heading-name="Indexd"><span class="tree-item-title">Indexd</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Peregrine"><div class="tree-item-contents heading-link" heading-name="Peregrine"><span class="tree-item-title">Peregrine</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Portal"><div class="tree-item-contents heading-link" heading-name="Portal"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Portal</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="5"><a class="tree-link" href="occ-gen3-x-krumware.html#JSON_HERE"><div class="tree-item-contents heading-link" heading-name="JSON HERE"><span class="tree-item-title">JSON HERE</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Revproxy"><div class="tree-item-contents heading-link" heading-name="Revproxy"><span class="tree-item-title">Revproxy</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="occ-gen3-x-krumware.html#Sheepdog"><div class="tree-item-contents heading-link" heading-name="Sheepdog"><span class="tree-item-title">Sheepdog</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="occ-gen3-x-krumware.html#Step_1:_Set_up_VM_allowing_access_to_AWS_Account_and_Gen3_cloud-automation"><div class="tree-item-contents heading-link" heading-name="Step 1: Set up VM allowing access to AWS Account and Gen3 cloud-automation"><span class="tree-item-title">Step 1: Set up VM allowing access to AWS Account and Gen3 cloud-automation</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="occ-gen3-x-krumware.html#Step_2:_Spin_up_VPC"><div class="tree-item-contents heading-link" heading-name="Step 2: Spin up VPC"><span class="tree-item-title">Step 2: Spin up VPC</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="occ-gen3-x-krumware.html#Assumption"><div class="tree-item-contents heading-link" heading-name="Assumption"><span class="tree-item-title">Assumption</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>